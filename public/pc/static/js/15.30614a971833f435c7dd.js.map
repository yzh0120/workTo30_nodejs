{"version":3,"sources":["webpack:///src/components/me/UserData.vue","webpack:///./src/components/me/UserData.vue?e94d","webpack:///./src/components/me/UserData.vue"],"names":["login","Object","vuex_esm","UserData","name","data","fileList","ws_beforeRead","ws_mName","errName","user_name","methods","extends_default","mapMutations","setHandler","mName","_this","this","params","$api","user","then","res","$toast","dataURLtoFile","dataurl","filename","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","File","type","afterRead","file","_this2","console","log","whatKB","size","finalFlie","quality","undefined","image","Image","src","content","onload","w","width","canvas","height","document","createElement","context","getContext","drawImage","finalDataUrl","toDataURL","formData","FormData","append","userInfo","user_img","headPor","beforeRead","computed","mapState","state","components","mounted","watch","handler","newName","oldName","test","me_UserData","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","after-read","max-count","before-read","upload-text","model","value","callback","$$v","expression","_v","center","clearable","label","placeholder","error-message","slot","on","click","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/15.30614a971833f435c7dd.js","sourcesContent":["<template>\n  <div class=\"am-userData\">\n    <!-- <SignUp></SignUp> -->\n    <div class=\"user\">\n\n      <van-uploader :after-read=\"afterRead\"  v-model=\"fileList\" :max-count=\"1\"\n      :before-read=\"beforeRead\" upload-text='修改头像' class=\"headPor\"/>\n\n\n        <!-- <van-field v-model=\"user_name\" label=\"您的昵称\"  left-icon=\"smile-o\"\n         :error-message=\"errName\" placeholder=\"请输入您修改的昵称\" class=\"user_name\"/>\n\n         <van-button type=\"primary\" size=\"large\" @click=\"mName\">修改昵称</van-button> -->\n         <van-field\n           v-model=\"user_name\"\n           center\n           clearable\n           label=\"修改姓名\"\n           placeholder=\"请输入修改姓名\"\n           :error-message=\"errName\"\n         >\n           <van-button slot=\"button\" size=\"small\" type=\"primary\" @click=\"mName\">提交修改</van-button>\n         </van-field>\n    </div>\n  </div>\n</template>\n\n<script>\n\t/* 引入导航栏组件*/\n\t// import SignUp from \"@/components/me/utils/SignUp\"\n\n  import {createNamespacedHelpers} from 'vuex'\n  const navBar_Every=createNamespacedHelpers('navBar_Every')\n  const login=createNamespacedHelpers('login')\n  // import List from \"@/components/utils/ListForMe\"\n  export default{\n    name:\"\",\n    /* 数据*/\n    data(){\n      return {\n        fileList : [],\n        // 头像正在上传中\n        // headPorIsUploading : false,\n        ws_beforeRead : false,\n        // user_nameIsUploading : false,\n        ws_mName : false,\n        errName : '',\n        user_name : ''\n      }\n    },\n    /* 方法*/\n    methods:{\n      // 导航栏标题\n      // ...navBar_Every.mapMutations({\n      //       \ttitleHandler: 'titleHandler'\n      //       }),\n      // 头像\n      // ...login.mapMutations({\n      //       \tuser_imgHandler: 'user_imgHandler'\n      //       }),\n      // 姓名\n      // ...login.mapMutations({\n      //       \tuser_nameHandler: 'user_nameHandler'\n      //       }),\n      ...login.mapMutations({\n              setHandler: 'setHandler'\n            }),\n      // 修改昵称\n      mName(){\n        if(this.ws_mName == true){\n           this.$toast(\"请等待昵称上传完成，长度2-16\")\n          return;\n        }\n        this.ws_mName = true\n\n        if( (!!this.errName == true) || (!!this.user_name == false) ){\n          this.$toast(\"昵称可以包含汉字字母数字，长度2-16\")\n          return;\n        }\n        var params = {\n          user_name : this.user_name\n        }\n        this.$api.user.mName(params).then(\n            res =>{\n              // if(res.data == 'success'){\n                this.$toast(\"上传昵称成功,刷新页面即可生效\")\n                this.ws_mName = false\n                // this.user_nameHandler(res.data)\n                this.setHandler(['user_name',res.data])\n              // }else{\n              //   this.fileList = []\n              // }\n            }\n        )\n      },\n      // DataURL 转换为 File\n      dataURLtoFile(dataurl,filename){\n        var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n                bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n        \t\twhile(n--){\n        \t\t\tu8arr[n] = bstr.charCodeAt(n);\n        \t\t}\n        \t\treturn new File([u8arr], filename, {type:mime});\n      },\n      // 上传图像\n      afterRead(file) {\n        console.log('未处理', file)\n        /* 计算图像压缩比例**********************/\n        let whatKB = file.file.size/1024;//图像多少kB\n        console.log(whatKB,'whatKB')\n        let quality;//图像质量\n        if(whatKB>50){//图像质量大于50kB 压缩\n          quality = 50 / whatKB\n          console.log(quality,'压缩')\n        }else{//小于等于50kB 不压缩\n          quality = undefined\n        }\n        // var that = this;////////////////\n        var finalFlie;\n         var image = new Image();\n         // file.content 是data url格式\n         image.src =file.content\n         image.onload = ()=> {\n          var w = image.width * 1,\n              h = image.height,\n              //quality = 0.5, //图像质量\n              canvas = document.createElement('canvas'),\n              context = canvas.getContext('2d');\n\n              canvas.width = w;\n              canvas.height = w * (image.height / image.width);\n              context.drawImage(image, 0, 0, canvas.width, canvas.height);\n              // var finalDataUrl = canvas.toDataURL(file.file.type,quality);\n              var finalDataUrl = canvas.toDataURL(\"image/jpeg\",quality);\n              // var finalDataUrl = canvas.toDataURL(file.file.type);\n              finalFlie = this.dataURLtoFile(finalDataUrl,file.file.name)\n                // console.log(finalDataUrl,'finalDataUrl')\n                // console.log(finalFlie,'finalFlie')\n\n         // //}//\n         // console.log(finalFlie,'123456')\n        // console.log(file.file,'123456')\n        let formData = new FormData()\n        // formData.append('file', file.file)\n        formData.append('file',finalFlie)\n        /* */\n        formData.append('oldHeadPort',this.userInfo.user_img)\n        /* */\n        this.$api.user.headPor(formData).then(\n            res =>{\n              // if(res.data == 'success'){\n                this.$toast(\"上传头像成功,刷新页面即可生效\")\n                this.ws_beforeRead = false\n                // this.user_imgHandler(res.data)\n                this.setHandler(['user_img',res.data])\n                // this.$router.go(0);\n              // }else{\n              //   this.fileList = []\n              // }\n            }\n        )\n        }\n        //////////////////////////////////结束\n      },\n      // 在读取前\n      beforeRead(file){\n        if(this.ws_beforeRead == true){\n           this.$toast(\"请等待头像上传完成\")\n          return;\n        }\n        this.ws_beforeRead = true\n\n        var isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n        if (!isJPG  ) {\n          this.$toast(\"上传头像图片只能是 JPG 或者 PNG 格式!\")\n          return false;\n        }\n        return true;\n\n      },\n    },\n    /* 计算*/\n    computed:{\n     ...login.mapState({\n          \tuserInfo : state => state.userInfo\n          }),\n     // ...login.mapState({\n     //            \thasLogin : state => state.hasLogin\n     //            }),\n    },\n    // 组件\n    components : {\n    \t/* 这个组件名字不能和原生标签名重复 */\n      // SignUp\n      // List\n    },\n    /* 挂载阶段*/\n    mounted() {\n      // this.titleHandler('修改资料')\n    },\n    // activated(){\n\n    // },\n    // 监听\n    watch:{\n      user_name: {\n          handler(newName, oldName) {\n            // 昵称可以包含汉字字母数字，长度2-16\n           var nameReg = /^[\\u4e00-\\u9fff\\w]{2,16}$/;\n          if(!nameReg.test(this.user_name)){\n            // this.$tip(\"邮箱格式不正确\",\"warning\")\n            this.errName = '昵称可以包含汉字字母数字，长度2-16'\n          }else{\n            this.errName = ''\n          }\n          },\n          // immediate: true,\n          // deep: true\n        },\n    }\n  }\n</script>\n\n<style scoped lang=\"scss\">\n  .am-userData{\n    // @extend %top;\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/me/UserData.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"am-userData\"},[_c('div',{staticClass:\"user\"},[_c('van-uploader',{staticClass:\"headPor\",attrs:{\"after-read\":_vm.afterRead,\"max-count\":1,\"before-read\":_vm.beforeRead,\"upload-text\":\"修改头像\"},model:{value:(_vm.fileList),callback:function ($$v) {_vm.fileList=$$v},expression:\"fileList\"}}),_vm._v(\" \"),_c('van-field',{attrs:{\"center\":\"\",\"clearable\":\"\",\"label\":\"修改姓名\",\"placeholder\":\"请输入修改姓名\",\"error-message\":_vm.errName},model:{value:(_vm.user_name),callback:function ($$v) {_vm.user_name=$$v},expression:\"user_name\"}},[_c('van-button',{attrs:{\"slot\":\"button\",\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":_vm.mName},slot:\"button\"},[_vm._v(\"提交修改\")])],1)],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-39c94bfd\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/me/UserData.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-39c94bfd\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!sass-resources-loader?{\\\"resources\\\":\\\"H:\\\\\\\\aaa\\\\\\\\good\\\\\\\\vueForWeb\\\\\\\\src\\\\\\\\assets\\\\\\\\scss\\\\\\\\global.scss\\\"}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./UserData.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./UserData.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./UserData.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-39c94bfd\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./UserData.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-39c94bfd\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/me/UserData.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}
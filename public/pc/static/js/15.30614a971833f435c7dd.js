webpackJsonp([15],{"3SDJ":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),r=a.n(n),s=a("NYxO"),i=(Object(s.a)("navBar_Every"),Object(s.a)("login")),o={name:"",data:function(){return{fileList:[],ws_beforeRead:!1,ws_mName:!1,errName:"",user_name:""}},methods:r()({},i.mapMutations({setHandler:"setHandler"}),{mName:function(){var e=this;if(1!=this.ws_mName)if(this.ws_mName=!0,1!=!!this.errName&&0!=!!this.user_name){var t={user_name:this.user_name};this.$api.user.mName(t).then(function(t){e.$toast("上传昵称成功,刷新页面即可生效"),e.ws_mName=!1,e.setHandler(["user_name",t.data])})}else this.$toast("昵称可以包含汉字字母数字，长度2-16");else this.$toast("请等待昵称上传完成，长度2-16")},dataURLtoFile:function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],r=atob(a[1]),s=r.length,i=new Uint8Array(s);s--;)i[s]=r.charCodeAt(s);return new File([i],t,{type:n})},afterRead:function(e){var t=this;console.log("未处理",e);var a=e.file.size/1024;console.log(a,"whatKB");var n,r=void 0;a>50?(r=50/a,console.log(r,"压缩")):r=void 0;var s=new Image;s.src=e.content,s.onload=function(){var a=1*s.width,i=(s.height,document.createElement("canvas")),o=i.getContext("2d");i.width=a,i.height=a*(s.height/s.width),o.drawImage(s,0,0,i.width,i.height);var l=i.toDataURL("image/jpeg",r);n=t.dataURLtoFile(l,e.file.name);var u=new FormData;u.append("file",n),u.append("oldHeadPort",t.userInfo.user_img),t.$api.user.headPor(u).then(function(e){t.$toast("上传头像成功,刷新页面即可生效"),t.ws_beforeRead=!1,t.setHandler(["user_img",e.data])})}},beforeRead:function(e){if(1!=this.ws_beforeRead)return this.ws_beforeRead=!0,!!("image/jpeg"===e.type||"image/png"===e.type)||(this.$toast("上传头像图片只能是 JPG 或者 PNG 格式!"),!1);this.$toast("请等待头像上传完成")}}),computed:r()({},i.mapState({userInfo:function(e){return e.userInfo}})),components:{},mounted:function(){},watch:{user_name:{handler:function(e,t){/^[\u4e00-\u9fff\w]{2,16}$/.test(this.user_name)?this.errName="":this.errName="昵称可以包含汉字字母数字，长度2-16"}}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"am-userData"},[a("div",{staticClass:"user"},[a("van-uploader",{staticClass:"headPor",attrs:{"after-read":e.afterRead,"max-count":1,"before-read":e.beforeRead,"upload-text":"修改头像"},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}}),e._v(" "),a("van-field",{attrs:{center:"",clearable:"",label:"修改姓名",placeholder:"请输入修改姓名","error-message":e.errName},model:{value:e.user_name,callback:function(t){e.user_name=t},expression:"user_name"}},[a("van-button",{attrs:{slot:"button",size:"small",type:"primary"},on:{click:e.mName},slot:"button"},[e._v("提交修改")])],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(o,l,!1,function(e){a("Qm+f")},"data-v-39c94bfd",null);t.default=u.exports},"Qm+f":function(e,t){}});
//# sourceMappingURL=15.30614a971833f435c7dd.js.map